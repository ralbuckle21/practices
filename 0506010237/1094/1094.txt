Sorting It All Out
Time Limit: 1000MS   Memory Limit: 10000K 
Total Submissions: 9021   Accepted: 2958 

Description

An ascending sorted sequence of distinct values is one in which some form of a less-than operator is used to order the elements from smallest to largest. For example, the sorted sequence A, B, C, D implies that A < B, B < C and C < D. in this problem, we will give you a set of relations of the form A < B and ask you to determine whether a sorted order has been specified or not. 
Input

Input consists of multiple problem instances. Each instance starts with a line containing two positive integers n and m. the first value indicated the number of objects to sort, where 2 <= n <= 26. The objects to be sorted will be the first n characters of the uppercase alphabet. The second value m indicates the number of relations of the form A < B which will be given in this problem instance. Next will be m lines, each containing one such relation consisting of three characters: an uppercase letter, the character "<" and a second uppercase letter. No letter will be outside the range of the first n letters of the alphabet. Values of n = m = 0 indicate end of input.
Output

For each problem instance, output consists of one line. This line should be one of the following three: 

Sorted sequence determined after xxx relations: yyy...y. 
Sorted sequence cannot be determined. 
Inconsistency found after xxx relations. 

where xxx is the number of relations processed at the time either a sorted sequence is determined or an inconsistency is found, whichever comes first, and yyy...y is the sorted, ascending sequence. 

Sample Input

4 6
A<B
A<C
B<C
C<D
B<D
A<B
3 2
A<B
B<A
26 1
A<Z
0 0
Sample Output

Sorted sequence determined after 4 relations: ABCD.
Inconsistency found after 2 relations.
Sorted sequence cannot be determined.其实这道题目一看就是图论，现在正在复习数据结构，顺便拿来练练手，在这里首先祝愿我的数据结构不要挂。这道题输入一次就判断一次是否有环，然后才能进行其他的操作。不明白的看下代码，
#include"stdio.h" 
#include"string.h"
 #include"stdlib.h" 
 typedef struct Node{         
         int d;         
         char c; 
         }Node;           
 int map[26][26],used[26],flag,n;
  Node node[26]; 
  int cmp(const void *a, const void *b) {  
         return (*(Node *)a).d-(*(Node *)b).d; }
void check() {  
        int i,j;    
          for(i=0;i<n;i++)   
             {         
                 if(used[i]==0)     
                return ;         
     for(j=0;j<n;j++)     
               if(map[i][j])      
               node[j].d++;  
          }      //for(i=0;i<n;i++) printf("%d:%d\n",i,node[i].d);  
 qsort(node,n,sizeof(Node),cmp);   
    for(i=0;i<n;i++)      
       if(node[i].d!=i)         
          return ;    
            flag=2; }  
int main() 
 {   
     int row,i,j,a,b,k,h; 
         char s[4];   
 while(1) 
     {  
       scanf("%d%d",&n,&row);  
       if(n==0 && row==0)    
        break;         
      flag=0;      
    memset(map,0,sizeof(map));   
      for(h=1;h<=row;h++)    
         {            
          scanf("%s",s);          
          if(!flag)    
              {       
                a=s[0]-65;      
                b=s[2]-65;    
                used[a]=1;     
                used[b]=1;          
                for(i=0;i<n;++i)   
                {           
                 node[i].d=0;  
                 node[i].c=i+65;    
                }       
                if(map[b][a]==1 || a==b)   
                {        
                 printf("Inconsistency found after %d relations.\n",h); 
                 flag=1;         
                }          
          else    
           map[a][b]=1;       
           for(k=0;k<26;++k)          
            for(i=0;i<26;++i)       
             for(j=0;j<26;++j)         
              map[i][j]=(map[i][j]||(map[i][k]&&map[k][j]));           
               if(!flag)    
               check();         
               if(flag==2)        
                  {  
                    printf("Sorted sequence determined after %d relations: ",h);    
                    for(i=0;i<n;i++) 
                    printf("%c",node[i].c);  
                    printf(".\n");           
                  }        
              }       
      }              
    if(!flag)            
  printf("Sorted sequence cannot be determined.\n"); 
    } 
return 0;
} 
